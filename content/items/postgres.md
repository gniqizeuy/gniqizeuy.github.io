---
title: "postgresql"
date: 2021-08-10
draft: false
---

#### 处理和创建 JSON 数据

**`json`和`jsonb` 操作符**

| 操作符 | 右操作数类型 | 返回类型          | 描述                                                    | 例子                                               | 例子结果       |
| ------ | ------------ | ----------------- | ------------------------------------------------------- | -------------------------------------------------- | -------------- |
| `->`   | `int`        | `json` or `jsonb` | 获得 JSON 数组元素（索引从 0 开始，负整数从末尾开始计） | `'[{"a":"foo"},{"b":"bar"},{"c":"baz"}]'::json->2` | `{"c":"baz"}`  |
| `->`   | `text`       | `json` or `jsonb` | 通过键获得 JSON 对象域                                  | `'{"a": {"b":"foo"}}'::json->'a'`                  | `{"b":"foo"}`  |
| `->>`  | `int`        | `text`            | 以`text`形式获得 JSON 数组元素                          | `'[1,2,3]'::json->>2`                              | `3`            |
| `->>`  | `text`       | `text`            | 以`text`形式获得 JSON 对象域                            | `'{"a":1,"b":2}'::json->>'b'`                      | `2`            |
| `#>`   | `text[]`     | `json` or `jsonb` | 获取在指定路径的 JSON 对象                              | `'{"a": {"b":{"c": "foo"}}}'::json#>'{a,b}'`       | `{"c": "foo"}` |
| `#>>`  | `text[]`     | `text`            | 以`text`形式获取在指定路径的 JSON 对象                  | `'{"a":[1,2,3],"b":[4,5,6]}'::json#>>'{a,2}'`      | `3`            |

> ### 注意
>
> 对`json`和`jsonb`类型，这些操作符都有其并行变体。  
> 域/元素/路径抽取操作符返回与其左手输入（`json`或`jsonb`） 相同的类型，不过那些被指定为返回`text`的除外，它们的返回值会被强制 为文本。如果该 JSON 输入没有匹配请求的正确结构（例如那样的元素不存在），这些 域/元素/路径抽取操作符会返回 NULL 而不是失败。 接受整数 JSON 数组下标的 域/元素/路径抽取操作符都支持表示从数组末尾开始的负值下标形式。

#### 清空表和自增序列

```sql
TRUNCATE [ TABLE ] [ ONLY ] name [ * ] [, ... ]
    [ RESTART IDENTITY | CONTINUE IDENTITY ] [ CASCADE | RESTRICT ]
```

##### 参数

- *`name`*

  要截断的表的名字（可以是模式限定的）。如果在表名前指定了 `ONLY`，则只会截断该表。如果没有指定`ONLY`， 该表及其所有后代表（如果有）都会被截断。可选地，可以在表名后指定 `*`来显式地包括后代表。

- `RESTART IDENTITY`

  自动重新开始被截断表的列所拥有的序列。

- `CONTINUE IDENTITY`

  不更改序列值。这是默认值。

- `CASCADE`

  自动截断所有对任一所提及表有外键引用的表以及任何由于 `CASCADE`被加入到组中的表。

- `RESTRICT`

  如果任一表上具有来自命令中没有列出的表的外键引用，则拒绝截断。这是默认值。
