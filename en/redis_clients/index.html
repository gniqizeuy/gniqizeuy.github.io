redis_clients
Redis 客户端API
redis 


<h4 id="toc_0">Python 客户端 redis-py</h4>

<p>redis-py 的基本使用方法、redis-py 的 Pipeline 的使用和 redis-py 的 Lua 脚本使用。</p>

<h4 id="toc_1">获取 redis-py</h4>

<p>redis-py 需要 Python 2.7 以上版本。获取方式如下：</p>

<pre><code class="shell"># 使用 pip 进行安装
pip install redis

# 使用 easy_install 安装
easy_install redis

# 源码安装：以2.10.5为例
wget https://guthub.com/andymccurdy/redis-py/archive/2.10.5.zip
uzip redis-2.10.5.zip
cd redis-2.10.5
# 安装 redis-py
python setup.py install
</code></pre>

<h4 id="toc_2">redis-py 的基本使用方法</h4>

<pre><code class="python">import redis

# 生产客户端连接：需 Redis 实例 IP 和端口两个参数
client = redis.StrictRedis(host='127.0.0.1', port=6379)

# 执行命令，redis-py API 保留了 Redis API 的原始风格
client.set(key, &quot;python-redis&quot;) # True
client.get(key) # world
</code></pre>

<h4 id="toc_3">redis-py 中的 Pipeline 的只使用方法</h4>

<pre><code class="python">pipline = client.pipline(transaction=False) # transaction False 代表不使用事务

# 将命令封装到 Pipline 中，此时命令并没有真正执行
pipline.set('hello', 'world')
pipline.incr('counter')

# 执行 Pipline
result = pipline.execute() # [True, 3]
</code></pre>

<h4 id="toc_4">redis-py 中的 Lua 脚本使用方法</h4>

<p>redid-py 提供了三个重要的函数实现 Lua 脚本的执行：</p>

<pre><code class="python">eval(String script, int keyCount, String... params)
script_load(String script)
evalsha(String sha1, int keyCount, String... params)
</code></pre>

<p>script：Lua 脚本内容；KeyCount：键的个数；params：相关参数 KEYS 和 ARGV。</p>

<p>return redis.call(&lsquo;get&rsquo;, KEYS[1])  在 redis-py 中实现如下</p>

<pre><code class="python">script = 'return redis.call('get', KEYS[1]) '
client.eval(script, 1, 'hello') # world
</code></pre>

<p>script_load 和 evalsha 函数一起使用，首先使用 script_load 将脚本加载到 Redis 中</p>

<pre><code class="python">scriptSha = client.script_load(script)
</code></pre>

<p>evalsha 函数用来执行脚本的哈希值，需要三个参数：</p>

<p>scriptSha：脚本的 SHA1；KeyCount：键的个数；params：相关参数 KEYS 和 ARGV。</p>

<p>执行效果如下</p>

<pre><code class="python">client.evalsha(scriptSha, 1, 'hello')
</code></pre>
